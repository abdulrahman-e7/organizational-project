(function ($) {
  "use strict";

  $('body').on('click', '#checkCoupon', function (e) {
    e.preventDefault();
    var $this = $(this);
    var couponInput = $('#coupon_input');
    var orderInput = $('#order_input');
    var invalidFeedback = couponInput.parent().find('.invalid-feedback');
    var coupon = couponInput.val();
    var orderId = orderInput.val();
    couponInput.removeClass('is-invalid is-valid');
    invalidFeedback.text(couponInvalidLng);

    if (coupon) {
      $this.addClass('loadingbar primary').prop('disabled', true);
      $.post('/cart/coupon/validate', {
        coupon: coupon,
        order_id: orderId
      }, function (result) {
          console.log(result);
        if (result && result.status == 200) {

          $('#totalAmount').text(result.total_amount);
        //   $('#taxPrice').text(result.total_tax);
          $('#totalDiscount').text(result.total_discount);
          $("#discount_percent").text("(" +result.discount_percent + '%' + ")");
          $('#cartForm input[name="discount_id"]').val(result.discount_id);
          $('#checkCoupon').prop('disabled', true);
          $(".price").addClass("text-decoration-line-through");
         $(".price").css("text-decoration-color", "black");

          $(".price-with-discount").text(result.total_amount);

          couponInput.addClass('is-valid');
        } else if (result && result.status == 422) {
          couponInput.removeClass('is-valid');
          couponInput.addClass('is-invalid');
          invalidFeedback.text(result.msg);
        }
      }).fail(function (jqXHR, textStatus, errorThrown) {
        console.log(jqXHR);
      }).always(function () {
        $this.removeClass('loadingbar primary').prop('disabled', false);
      });
    } else {
      couponInput.addClass('is-invalid');
    }
  });
})(jQuery);
